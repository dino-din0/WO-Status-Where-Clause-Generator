<!DOCTYPE html>
<html>

<head>
  <title>Maximo WO Report Generation Tool</title>
  <style>
    body {
      font-family: 'Helvetica', Arial, sans-serif;
      margin: 20px;
      overflow: auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .Top {
      width: 100%;
      height: 40px;
      left: 0;
      top: 0;
      position: absolute;
      background: #344149;
    }

    h1 {
      width: 100%;
      left: 0;
      position: absolute;
      top: 15px;

      color: #F7F7F7;
      position: absolute;
      text-align: left;
      font-weight: 550;
      word-wrap: break-word;
      background: #B25A00;
      padding: 20px;
      box-sizing: border-box;
    }

    h2 {
      width: 100%;
      left: 0;
      color: #000000;
      text-align: left;
      font-weight: 450;
      word-wrap: break-word;
    }

    h3 {
      width: 100%;
      left: 0;
      color: #B25A00;
      text-align: left;
      font-weight: 400;
      word-wrap: break-word;
    }

    input[type="text"] {
      width: 25%;
      box-sizing: border-box;
      margin-bottom: 10px;
    }

    main {
      top: 1-px;
      /* add container around this for bigger screens*/
      width: auto;
      height: 12px;
      position: relative;
      /* Change to relative positioning */
      flex-grow: 1;
      overflow: visible;
      color: black;
      font-size: 150%;
      font-family: Inter;
      font-weight: 400;
      word-wrap: break-word;
    }

    .input-group {
      margin-bottom: 10px;
    }

    .description {
      display: block;
      margin-top: 5px;
      font-size: 13px;
      color: #4b79c0;
    }

    hr {
      border: 1px solid #ccc;
      margin: 20px 0;
    }

    #whereClause {
      width: 100%;
      height: 150px;
      font-family: monospace;
    }

    button2 {
      /* Button for the examples */
      border-radius: 10%;
      width: 60px;
      height: 60px;
      background-color: #ccc;
      color: black;
      padding: 8px 12px;
      border: none;
      margin-right: 10px;
      cursor: pointer;
      font-size: 12px;
    }

    button2:hover {
      background-color: #ccc;
      color: #B25A00;
    }

    .question-mark {
      display: inline-block;
      width: 35px;
      height: 35px;
      background-color: #ccc;
      border-radius: 40px;
      text-align: center;
      cursor: pointer;
      font-size: 30px;
      position: relative;
    }

    .question-mark:hover {
      background-color: #ccc;
      color: #B25A00;
    }

    .smQM {
      /* Small Question Mark */
      display: inline-block;
      width: 15px;
      height: 15px;
      background-color: #ccc;
      border-radius: 20px;
      text-align: center;
      cursor: pointer;
      font-size: 15px;
      position: relative;
    }

    .smQM:hover {
      background-color: #ccc;
      color: #B25A00;
    }

    .info-text {
      display: none;
      position: relative;
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      width: 40%;
      text-align: center;
      left: 20%;
      transform: translateX(-50%);
      top: 5px;
    }

    .glow {
      background-color: orange;
    }

    footer {
      width: 100%;
      height: 2.5%;
      left: 0;
      bottom: 0;
      background: #B25A00;
      position: fixed;
    }
  </style>
  <div id="notification"
    style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #64d717; padding: 20px; border: 2px solid black; font-size: 36px;color: #F7F7F7; z-index: 9999;border-radius: 15px;">
  </div>
  <script>
    document.addEventListener('keydown', function (event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault(); // Prevent the default behavior (e.g., new line in a text area)
        generateWhereClause();
      }
    });

    document.addEventListener('keydown', function (event) {
      if (event.key === 'Enter' && event.shiftKey) {
        event.preventDefault(); // Prevent the default behavior (e.g., new line in a text area)
        copyToClipboard();
      }
    });
    window.addEventListener('load', function () {
      // Function to generate a random color from a list of colorHexList
      function getRandomColor() {
        const colorHexList = {
          blue: '#0000FF',
          purple: '#800080',
          green: '#008000',
          crimsonRed: '#DC143C',
          red: '#FF0000',
          orange: '#FFA500',
          orangeRed: '#FF4500',
          hotPink: '#FF69B4',
          navyBlue: '#000080'
        };
        const colorNames = Object.keys(colorHexList);
        const randomColorName = colorNames[Math.floor(Math.random() * colorNames.length)];
        return colorHexList[randomColorName];
      }
      let descriptionSpan = document.querySelector('.description');
      let textContent = descriptionSpan.textContent;
      descriptionSpan.innerHTML = textContent
        .split('')
        .map(letter => `<span style="color: ${getRandomColor()}">${letter}</span>`)
        .join('');
    });

    // Clear all Feilds and checkboxes
    function clearAllFields() {
      document.getElementById('buildings').value = '';
      document.getElementById('SearchDesc').value = '';
      document.getElementById('ExSearchDesc').value = '';
      document.getElementById('LegAS').value = '';
      document.getElementById('ExLegAS').value = '';

      // Uncheck all status checkboxes
      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
      });
      document.getElementById('whereClause').value = '';
    }
  </script>
</head>

<body>
  <!-- header -->
  <div class="Top">
    <h1>Maximo WO Report Generator
    </h1>
  </div>
  <br><br><br><br><br>
  <form id="searchForm">
  <div>
    <h2><strong><u>Speedy Actions - Doesn't do anything atm</u></strong></h2>
  </div>
  ** Be sure to define what these searches are looking for... refer to the 'Customize Search' below
  <br>
  <br>
  <!-- FIX Be sure to change the onclick actions -->
  <button2 type="button" onclick="fillOutExample1()">[300 Area] Current Month's WOs</button2>
  <button2 type="button" onclick="fillOutExample1()">[PSF] Current Month's WOs</button2>
  <br>
  <br>
  <button2 type="button" onclick="fillOutExample1()">[300 Area] Next Month's WOs</button2>
  <button2 type="button" onclick="fillOutExample1()">[PSF] Next Month's WOs</button2>
  <br>
  <br>
  <button2 type="button" onclick="fillOutExample1()">[300 Area] Last Month's WOs</button2>
  <button2 type="button" onclick="fillOutExample1()">[PSF] Last Month's WOs</button2>
  
    <hr> <!-- Header Line -->
    
    <div>
      <h2><strong><u>Customize Search</u></strong></h2>
    </div>
  
** Button to use/not use the custom search... I say this should not be included since the speedy actions should already have its own preset values, which should not be effected by a customized search
<br>
** Button for a custom date

    <div class="input-group">
      <label for="core_teamCheckboxes"><strong>Core Team</strong></label><br>
      <span>Select the Core Teams
      </span><br>
      <label for="300A_CT">
        <input type="checkbox" id="300A_core" value="PSF2CT"> 300 Area Core Team
      </label>
      <br>
      <label for="PSF_CT">
        <input type="checkbox" id="PSF_core" value="HRFCT"> PSF Core Team
      </label>
      <br>
      <label for="MSL_CT">
        <input type="checkbox" id="MSL_core" value="SFCT"> Sequim Core Team
      </label>
      <br>
      <!-- SOUTH CORE TEAMS INCLUDE CFCT, GSICT, PFCT, RFCT3, UFCT; THERE ARE OTHER CORE TEAMS TOO -->
    </div>

    <div class="input-group">
      <label for="wtlCheckboxes"><strong>Work Team Leads</strong></label><br>
      <span>Leave this blank to search all WTLs. Otherwise, select the WTLs you need
      </span><br>
      <label for="Josh_Henn">
        <input type="checkbox" id="wtl_henn" value="913053"> Josh Henn
      </label>
      <br>
      <label for="Nash_Hay">
        <input type="checkbox" id="wtl_hay" value="900277"> Nash Hay
      </label>
      <br>
      <label for="Jessey_Brown">
        <input type="checkbox" id="wtl_brown" value="3P292"> Jessey Brown
      </label>
      <br>
      <label for="Trevor_King">
        <input type="checkbox" id="wtl_king" value="903079"> Trevor King
      </label>
      <br>
      <!-- FIX - THIS PROB WON'T WORK -->
      <label for="Custom_WTL">
        <input type="checkbox" id="wtl_name"> Custom WTL (Enter Valid PNNLID) <input type="text" id="name-input" placeholder="PNNL ID Only" enabled> 
      </label>
    </div>

    <div class="input-group">
      <label for="spec_craftCheckboxes"><strong>Power Operator & Air Balance Craft in Search</strong></label><br>
      <span>Provides the option to exclude the Power Operator & Air Balance Craft
      </span><br>
      <label for="powerOp_airBal">
        <input type="checkbox" id="power_bal" value="yes"> Yes, include
      </label>
    </div>

    <div class="input-group">
      <label for="spec_craftCheckboxes"><strong>Include the month's weekly WOs</strong></label><br>
      <span>Provides the option to only search all the PMs due in that month alone
      </span><br>
      <label for="powerOp_airBal">
        <input type="checkbox" id="power_bal" value="yes"> Yes, include
      </label>
    </div>

      <hr> <!-- Header Line -->

  
    <!-- Status Checkboxes -->
    **Statuses are incorrect. Please check the WO specific ones
    <br>
    <div class="input-group">
      <label for="statusCheckboxes"><strong>Status(es):</strong></label><br>
      <span class="description">Leave this blank to search for all statuses. Otherwise, select the statuses you
        need.</span>
      <label for="status_operating">
        <input type="checkbox" id="status_operating" value="OPERATING"> OPERATING
      </label>
      <br>
      <label for="status_active">
        <input type="checkbox" id="status_active" value="ACTIVE"> ACTIVE
      </label>
      <br>
      <label for="status_decommissioned">
        <input type="checkbox" id="status_decommissioned" value="DECOMMISSIONED"> DECOMMISSIONED
      </label>
      <br>
      <label for="status_retired">
        <input type="checkbox" id="status_retired" value="RETIRED"> RETIRED
      </label>
      <br>
      <label for="status_inactive">
        <input type="checkbox" id="status_inactive" value="INACTIVE"> INACTIVE
      </label>
      <br>
      <label for="status_not_ready">
        <input type="checkbox" id="status_not_ready" value="NOT READY"> NOT READY
      </label>
      <br>
      <label for="status_disposed">
        <input type="checkbox" id="status_disposed" value="DISPOSED"> DISPOSED
      </label>
      <br>
      <label for="status_prepare_for_use">
        <input type="checkbox" id="status_prepare_for_use" value="PREPARE FOR USE"> PREPARE FOR USE
      </label>
      <br>
      <label for="status_storage">
        <input type="checkbox" id="status_storage" value="STORAGE"> STORAGE
      </label>
      <br>
      <label for="status_unoccupied">
        <input type="checkbox" id="status_unoccupied" value="UNOCCUPIED"> UNOCCUPIED
      </label>
      <br>
      <label for="status_draft">
        <input type="checkbox" id="status_draft" value="DRAFT"> DRAFT
      </label>
    </div>

    <hr> <!-- Header Line -->

    <!-- Button to generate Where Clause -->
    <button type="button" onclick="generateWhereClause()">Generate Where Clause</button>
    <span class="smQM" id="questionMark6">?</span>
    <div class="info-text" id="infoText6"> Click "Generate Where Clause" to generate the Where Clause below. You can
      also press
      <strong>Enter</strong> on your Keyboard
    </div>
    <h3>Generated Where Clause:</h3>
    <textarea id="whereClause" readonly></textarea>

    <button onclick="copyToClipboard()">Copy to Clipboard</button>&#160
    <span class="smQM" id="questionMark7">?</span>
    <div class="info-text" id="infoText7"> Click "Copy to Clipboard" to copy the Generated Where Clause above. You can
      also press
      <strong>Shift + Enter</strong> on your Keyboard
    </div>

  </form>
  <br>
  <footer></footer>
  </div>

  <!-- JavaScript Code for this HTML -->
  <script>
    window.addEventListener('load', function () {
      let questionMarks = document.querySelectorAll('.question-mark, .smQM'); // Include both regular and small question marks
      let infoTexts = document.querySelectorAll('.info-text');
      let activeIndex = null;

      questionMarks.forEach(function (questionMark, index) {
        questionMark.addEventListener('click', function () {
          if (activeIndex !== null) {
            infoTexts[activeIndex].style.display = 'none';
            questionMarks[activeIndex].classList.remove('glow');
          }

          if (activeIndex !== index) {
            infoTexts[index].style.display = 'block';
            questionMarks[index].classList.add('glow');
            activeIndex = index;
          } else {
            activeIndex = null;
          }
        });
      });
    });
    window.addEventListener('load', function () {
      let questionMarks = document.querySelectorAll('.question-mark' || ".smQM");
      let infoTexts = document.querySelectorAll('.info-text');
      let activeIndex = null;

      questionMarks.forEach(function (questionMark, index) {
        questionMark.addEventListener('click', function () {
          if (activeIndex !== null) {
            infoTexts[activeIndex].style.display = 'none';
            questionMarks[activeIndex].classList.remove('glow');
          }

          if (activeIndex !== index) {
            infoTexts[index].style.display = 'block';
            questionMarks[index].classList.add('glow');
            activeIndex = index;
          } else {
            activeIndex = null;
          }
        });
      });
    });

    // Everything below this is related to generating the where clause
    function generateWhereClause() {
      // Retrive valuves from the inputs
      function sanitizeInput(input) {
        // Remove extra spaces, leading/trailing commas, and invalid characters
        return input
          .replace(/\s+/g, ' ')       // Remove extra spaces
          .replace(/(^,|,$)/g, '')    // Remove leading/trailing commas
          .replace(/[\^*~.!@#]/g, '')  // Remove invalid characters (^ * ~ . ! @ #)
          .split(',')
          .filter(item => item.trim() !== '') // Remove empty items after splitting
          .join(',');
      }


      const selectedStatuses = [];
      const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
      checkboxes.forEach(checkbox => {
        selectedStatuses.push(checkbox.value);
      });
      
// Selects the correct date


            // Get the current date in YYYY-MM-DD format
      const currentDate = new Date().toISOString().slice(0, 10);

      // Extract year and month components
      const currentYear = currentDate.slice(0, 4);
      const currentMonth = currentDate.slice(5, 7);

      // Calculate the next month and year, handling rollover to the next year
      let nextMonth = Number(currentMonth) + 1;
      let nextYear = currentYear;
      if (nextMonth > 12) {
        nextMonth = 1;
        nextYear = Number(currentYear) + 1;
      }

      // Pad the month with a leading zero if necessary
      nextMonth = String(nextMonth).padStart(2, '0');

      // Determine the number of days in the next month, considering leap years
      const isLeapYear = nextYear % 4 === 0 && (nextYear % 100 !== 0 || nextYear % 400 === 0);
      const daysInMonth = nextMonth === '02' ? 28 + isLeapYear : 30 + (nextMonth % 2); // Shorter version for month lengths

      // Construct the first and last days of the next month in YYYY-MM-DD format
      const firstDay = `${nextYear}-${nextMonth}-01`;
      const lastDay = `${nextYear}-${nextMonth}-${daysInMonth}`;

      // Build the where clause with dynamic dates
      let whereClause = `
      (
      ((woclass = 'WORKORDER' or woclass = 'ACTIVITY')
      and (pnl_coreteam = 'HRFCT'
        and historyflag = 0
        and istask = 0
        and siteid = 'PNNLSITE'))
      and craft not in ('R070', 'R076')
      and pmduedate >= '${firstDay}'
      and pmduedate <= '${lastDay}'
      )`;

      
      // Start of creating the Where Clause
      // Site ID condition
      // let whereClause = '(siteid = \'PNNLSITE\')\n';

      // Set the generated where clause to the text area
      document.getElementById('whereClause').value = whereClause;

      const notification = document.getElementById('notification');
      notification.textContent = 'Where Clause Generated!';
      notification.style.display = 'block';
      // Automatically hide the notification after a few seconds
      setTimeout(function () {
        notification.style.display = 'none';
      }, 1000); // 1000 milliseconds (1 seconds)
    }

    //Copy to clipboard function
    function copyToClipboard() {
      event.preventDefault();
      const textarea = document.getElementById('whereClause');
      textarea.select();
      document.execCommand('copy');
      const notification = document.getElementById('notification');
      notification.textContent = 'Where Clause copied to Clipboard!';
      notification.style.display = 'block';

      // Automatically hide the notification after a few seconds
      setTimeout(function () {
        notification.style.display = 'none';
      }, 3000); // 3000 milliseconds (3 seconds)
    }


  </script>

</body>

</html>